import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,f as t}from"./app-034d064a.js";const p={},e=t(`<h1 id="app-filesystem-접근" tabindex="-1"><a class="header-anchor" href="#app-filesystem-접근" aria-hidden="true">#</a> App Filesystem 접근</h1><p>App에서 Filesystem에 접근하는 방법입니다.</p><h3 id="ios-세팅" tabindex="-1"><a class="header-anchor" href="#ios-세팅" aria-hidden="true">#</a> IOS 세팅</h3><p><code>UIFileSharingEnabled</code> 값을 추가 후 <code>YES</code> 로 변경해주세요.<br><code>LSSupportsOpeningDocumentsInPlace</code> 값을 추가 후 <code>YES</code> 로 변경해주세요.</p><h3 id="android-세팅" tabindex="-1"><a class="header-anchor" href="#android-세팅" aria-hidden="true">#</a> Android 세팅</h3><p>다음 문구를 추가해주세요.</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- AndroidManifest.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.READ_EXTERNAL_STORAGE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="플러그인-설치" tabindex="-1"><a class="header-anchor" href="#플러그인-설치" aria-hidden="true">#</a> 플러그인 설치</h3><p><code>yarn add @capacitor/filesystem</code> 설치 후 <code>npx cap sync</code> 명령어로 최신화시켜주세요.</p><h3 id="전체-코드" tabindex="-1"><a class="header-anchor" href="#전체-코드" aria-hidden="true">#</a> 전체 코드</h3><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directory<span class="token punctuation">,</span> Filesystem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@capacitor/filesystem&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> downloadFile <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  notFile<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Platform<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">.</span>capacitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> permission <span class="token operator">=</span> <span class="token keyword">await</span> Filesystem<span class="token punctuation">.</span><span class="token function">checkPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span>publicStorage <span class="token operator">===</span> <span class="token string">&quot;prompt&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> requestPermission <span class="token operator">=</span> <span class="token keyword">await</span> Filesystem<span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestPermission<span class="token punctuation">.</span>publicStorage <span class="token operator">===</span> <span class="token string">&quot;granted&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 권한 허용</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 거절 문구 =&gt; 권한 허용을 거절하실 경우 다운로드가 불가능합니다.</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span>publicStorage <span class="token operator">===</span> <span class="token string">&quot;granted&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> dirLength <span class="token operator">=</span> <span class="token punctuation">(</span>
            <span class="token keyword">await</span> Filesystem<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              path<span class="token operator">:</span> <span class="token constant">PATH</span><span class="token punctuation">,</span> <span class="token comment">// e.g. &quot;&quot;</span>
              directory<span class="token operator">:</span> Directory<span class="token punctuation">.</span>Documents<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>notFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> Filesystem<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              data<span class="token operator">:</span> data<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
              path<span class="token operator">:</span> <span class="token constant">PATH</span><span class="token punctuation">,</span> <span class="token comment">// e.g. \`\${img_\${NUMBER}}\`</span>
              directory<span class="token operator">:</span> Directory<span class="token punctuation">.</span>Documents<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> Filesystem<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              url<span class="token operator">:</span> data<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
              path<span class="token operator">:</span> <span class="token constant">PATH</span><span class="token punctuation">,</span> <span class="token comment">// e.g. \`\${img_\${NUMBER}}\`</span>
              directory<span class="token operator">:</span> Directory<span class="token punctuation">.</span>Documents<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 실패 문구</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span>publicStorage <span class="token operator">===</span> <span class="token string">&quot;denied&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 거절 상황 =&gt; 앱 설정에 들어가 파일 권한을 허용해주세요. 등의 문구</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> downloadTag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      downloadTag<span class="token punctuation">.</span>href <span class="token operator">=</span> data<span class="token punctuation">.</span>url<span class="token punctuation">;</span>

      downloadTag<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">;</span>

      downloadTag<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      downloadTag<span class="token punctuation">.</span>parentNode<span class="token operator">?.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>downloadTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>모바일 웹에서도 다운로드가 가능해야하니, capacitor로 접속했을때와 분기를 나누었습니다.</p>`,12),o=[e];function c(i,l){return s(),a("div",null,o)}const d=n(p,[["render",c],["__file","app-filesystem.html.vue"]]);export{d as default};
