import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as s,f as t}from"./app-44f964f4.js";const e={},p=t(`<h1 id="푸시-알림-보내기" tabindex="-1"><a class="header-anchor" href="#푸시-알림-보내기" aria-hidden="true">#</a> 푸시 알림 보내기</h1><p>@capacitor/push-notifications 를 이용한 푸시알림 보내는 기능을 구현해보겠습니다.</p><p>우선 firebase 콘솔에서 프로젝트를 만들고 android와 apple 을 각각 만들고, <code>google-services.json</code>과 <code>GoogleService-Info.plist</code> 파일을 적절한 위치에 넣어주세요.</p><p>FCM의 가이드를 따르지 않고, 파일들만 넣어주어야 합니다. 특히 절대로 Xcode 에서 <code>firebase-ios-sdk</code> 를 설치하지마세요.</p><br><p>Xcode 에서는 폴더를 오른쪽 클릭 후 <code>Add files to &quot;App&quot;...</code> 을 눌러 넣어주어야 합니다. 폴더에 그냥 넣으면 인식하지 못합니다.</p><br><p>이제 프로젝트에서 <code>yarn add @capacitor/push-notifications</code> 해당 라이브러리를 설치 후 <code>npx cap sync</code> 를 해주세요.</p><h2 id="공통-설정" tabindex="-1"><a class="header-anchor" href="#공통-설정" aria-hidden="true">#</a> 공통 설정</h2><p><code>capacitor.config.json</code> 파일에 다음 코드를 넣어주세요.</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;PushNotifications&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;presentationOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;badge&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sound&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alert&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>앱이 foreground 상태일때 푸시 알림이 표시되는 방식을 구성하는 것입니다.</p><h2 id="ios의-경우" tabindex="-1"><a class="header-anchor" href="#ios의-경우" aria-hidden="true">#</a> IOS의 경우</h2><h3 id="appdelegate-swift-파일에-다음-코드를-넣어주세요" tabindex="-1"><a class="header-anchor" href="#appdelegate-swift-파일에-다음-코드를-넣어주세요" aria-hidden="true">#</a> <code>AppDelegate.swift</code> 파일에 다음 코드를 넣어주세요.</h3><div class="language-swift line-numbers-mode" data-ext="swift"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Firebase</span>

<span class="token keyword">func</span> <span class="token function-definition function">application</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> application<span class="token punctuation">:</span> <span class="token class-name">UIApplication</span><span class="token punctuation">,</span> didFinishLaunchingWithOptions launchOptions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UIApplication</span><span class="token punctuation">.</span><span class="token class-name">LaunchOptionsKey</span><span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
    <span class="token class-name">FirebaseApp</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// add here</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// add</span>
<span class="token keyword">func</span> <span class="token function-definition function">application</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> application<span class="token punctuation">:</span> <span class="token class-name">UIApplication</span><span class="token punctuation">,</span> didRegisterForRemoteNotificationsWithDeviceToken deviceToken<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Messaging</span><span class="token punctuation">.</span><span class="token function">messaging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>apnsToken <span class="token operator">=</span> deviceToken
    <span class="token class-name">Messaging</span><span class="token punctuation">.</span><span class="token function">messaging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>token<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> error <span class="token operator">=</span> error <span class="token punctuation">{</span>
            <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token punctuation">.</span>capacitorDidFailToRegisterForRemoteNotifications<span class="token punctuation">,</span> object<span class="token punctuation">:</span> error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> token <span class="token operator">=</span> token <span class="token punctuation">{</span>
            <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token punctuation">.</span>capacitorDidRegisterForRemoteNotifications<span class="token punctuation">,</span> object<span class="token punctuation">:</span> token<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">application</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> application<span class="token punctuation">:</span> <span class="token class-name">UIApplication</span><span class="token punctuation">,</span> didFailToRegisterForRemoteNotificationsWithError error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token punctuation">.</span>capacitorDidFailToRegisterForRemoteNotifications<span class="token punctuation">,</span> object<span class="token punctuation">:</span> error<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="podfile" tabindex="-1"><a class="header-anchor" href="#podfile" aria-hidden="true">#</a> Podfile</h3><div class="language-ruby line-numbers-mode" data-ext="rb"><pre class="language-ruby"><code>target <span class="token string-literal"><span class="token string">&#39;App&#39;</span></span> <span class="token keyword">do</span>
  capacitor_pods
  pod <span class="token string-literal"><span class="token string">&#39;Firebase/Messaging&#39;</span></span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="xcode" tabindex="-1"><a class="header-anchor" href="#xcode" aria-hidden="true">#</a> Xcode</h3><p>App을 더블클릭 한 후 TARGETS -&gt; Signing &amp; Capabilities 로 이동 후, + Capability를 눌러 Push Notifications 를 추가해주세요.</p><p>최근에 인증키가 바뀌었는데 <code>응용 프로그램을 위한 유효한 &#39;aps-environment&#39; 인타이틀먼트 문자열을 찾을 수 없습니다.</code> 라는 에러 문구가 보인다면<br> Firebase 콘솔 프로젝트에서 클라우드 메시징 -&gt; Apple 앱 구성 -&gt; APN 인증 키 삭제 후 APN 인증서 두 개를 (개발, 프로덕션) 등록해주세요.</p><p><br> <br></p><h2 id="android의-경우" tabindex="-1"><a class="header-anchor" href="#android의-경우" aria-hidden="true">#</a> Android의 경우</h2><p>다음 처럼 추가해주세요.</p><h3 id="variables-gradle" tabindex="-1"><a class="header-anchor" href="#variables-gradle" aria-hidden="true">#</a> <code>variables.gradle</code></h3><p>com.google.firebase:firebase-messaging 의 버전을 23.1.2 로 사용하겠다는 것입니다.</p><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>ext <span class="token punctuation">{</span>
    firebaseMessagingVersion <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;23.1.2&quot;</span></span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="string-xml-androidmanifest-xml" tabindex="-1"><a class="header-anchor" href="#string-xml-androidmanifest-xml" aria-hidden="true">#</a> string.xml &amp; AndroidManifest.xml</h3><p>다음 코드를 등록해주셔야 정상적으로 안드로이드 기기 푸시 알림이 동작합니다.</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- app/src/main/res/values/strings.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default_notification_channel_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{CHANNEL_ID}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- AndroidManifest.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span>
<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.google.firebase.messaging.default_notification_channel_id<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/default_notification_channel_id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>별도의 푸시 알림 아이콘을 사용하시려면 다음 코드에서 @mipmap/push_icon_name 을 수정해주세요.</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.google.firebase.messaging.default_notification_icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@mipmap/push_icon_name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,32),o=[p];function i(c,l){return a(),s("div",null,o)}const r=n(e,[["render",i],["__file","push-notification.html.vue"]]);export{r as default};
