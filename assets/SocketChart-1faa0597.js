import{a as _}from"./axios-4a70c6fc.js";import{d as b}from"./dayjs.min-1cecb027.js";import k from"./EchartsDefault-afadcc29.js";import{c as o}from"./rule-b4386e74.js";import{g as S,h as p,j as C,o as L,c as O,a as j,t as A,e as T,F as B}from"./app-663d7f0f.js";import{_ as M}from"./plugin-vue_export-helper-c27b6911.js";import"./commonjsHelpers-042e6b4d.js";import"./install-d2ff9668.js";const D={style:{"background-color":"#00000010",padding:"1rem","border-radius":"4px"}},I=S({__name:"SocketChart",setup(H){const c=p({animationDuration:100,animationDurationUpdate:100,title:{text:"비트코인",subtext:"KRW-BTC",left:"center",top:40,textStyle:{fontSize:25}},tooltip:{trigger:"axis"},xAxis:[{type:"category",data:[],boundaryGap:!0,axisLabel:{show:!1},axisPointer:{show:!0},axisLine:{show:!1},axisTick:{show:!1}},{type:"category",gridIndex:1,data:[],boundaryGap:!0,axisLine:{lineStyle:{color:"#777"}},axisPointer:{type:"shadow",triggerTooltip:!0},nameLocation:"middle",nameTextStyle:{fontStyle:"italic",lineHeight:40}}],yAxis:[{scale:!0,splitNumber:2,axisLine:{lineStyle:{color:"#777"}},axisTick:{show:!1},axisLabel:{inside:!1,formatter:`{value}
`},position:"right",splitArea:{show:!0}},{scale:!0,gridIndex:1,splitNumber:2,axisLabel:{inside:!1,formatter:`{value}
`,fontSize:10},axisTick:{show:!1},splitLine:{show:!0},position:"right",nameTextStyle:{fontSize:5},splitArea:{show:!0}}],grid:[{left:20,right:80,top:110,height:200},{left:20,right:80,height:80,top:340}],dataZoom:[{show:!0,type:"inside",filterMode:"filter",xAxisIndex:[0,1]}],series:[{name:"Volume",type:"bar",xAxisIndex:1,yAxisIndex:1,data:[],itemStyle:{color:t=>t.data[2]===0?o.same:t.data[2]===1?o.up:o.down},barWidth:"70%",colorBy:"data"},{type:"candlestick",data:[],itemStyle:{color:o.down,color0:o.up,borderColor:o.down,borderColor0:o.up,borderColorDoji:o.same},barWidth:"70%",markLine:{symbol:"none",data:[{yAxis:0,label:{color:"white",fontSize:8,lineHeight:14,padding:[0,4],borderRadius:4,formatter:({value:t})=>t.toLocaleString()},lineStyle:{type:[.5],dashOffset:.5}}]}}]}),n=p({}),d=p({}),h=p({}),f=p(!1),x=(t,s,a)=>{t.data[0].yAxis=s[0],t.data[0].lineStyle.color=a(s),t.data[0].label.backgroundColor=a(s)},y=async(t=50)=>{const s=await _.get(`https://api.upbit.com/v1/candles/minutes/1?market=KRW-BTC&count=${t}`);for(const a in s.data.reverse()){const e=s.data[a],r=b(e.candle_date_time_kst).format("HH:mm"),l=e.trade_price,u=e.opening_price;n.value[r]=[l,u,e.low_price,e.high_price];const i=Object.keys(d.value);d.value[r]=[i.indexOf(r)===-1?Object.keys(d.value).length:i.indexOf(r),Math.round(e.candle_acc_trade_volume*1e3)/1e3,l===u?0:l>u?1:2]}c.value.xAxis.forEach(a=>{a.data=Object.keys(n.value)}),c.value.series[0].data=Object.values(d.value),c.value.series[1].data=Object.values(n.value),x(c.value.series[1].markLine,Object.values(n.value)[Object.values(n.value).length-1],([a,e])=>a===e?o.same:a>e?o.up:o.down),f.value=!1};let m;const w=()=>{m=new WebSocket("wss://api.upbit.com/websocket/v1"),m.onopen=t=>{m.send(`${JSON.stringify([{ticket:"trade"},{type:"trade",codes:["KRW-BTC"]},{format:"SIMPLE"}])}`)},m.onmessage=async t=>{const s=await new Response(t.data).json();if(h.value=s,f.value)return;const a=b(s.tms).format("HH:mm");if(!n.value[a]||!d.value[a]){f.value=!0,y(2);return}const e=n.value[a],r=e[1],l=d.value[a],{tv:u,tp:i}=s;l[1]=Math.round((l[1]+u)*1e3)/1e3,l[2]=i===r?0:i>r?1:2,e[0]=i,e[2]=Math.min(e[2],i),e[3]=Math.max(e[3],i),x(c.value.series[1].markLine,e,([v,g])=>v===g?o.same:v>g?o.up:o.down)}};return C(()=>{y(),w()}),(t,s)=>(L(),O(B,null,[j("div",D,A(h.value),1),T(k,{style:{width:"100%",height:"500px"},"binding-options":c.value},null,8,["binding-options"])],64))}}),F=M(I,[["__file","SocketChart.vue"]]);export{F as default};
